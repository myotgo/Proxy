# لایه ۷: دامنه واقعی + TLS - بهترین روش کلی

> **⭐⭐⭐⭐⭐ بهترین روش (سخت‌ترین برای فیلتر شدن)**
> پورت 443 - تونل TLS واقعی + gRPC با گواهی معتبر

[← بازگشت به راهنمای اصلی](../README.fa.md)

---

## این روش چیست؟

این روش از یک **دامنه واقعی** و **گواهی TLS معتبر** استفاده می‌کند.
ترافیک شما دقیقاً شبیه یک وب‌سایت HTTPS معمولی است.

**چرا بهترین است:**
- دامنه واقعی (Real Domain)
- گواهی TLS معتبر (Let's Encrypt)
- اثر انگشت TLS طبیعی
- بدون امضای واضح پروکسی

**نتیجه:** ترافیک از مرور وب معمولی قابل تشخیص نیست.

**امنیت:** ⭐⭐⭐⭐⭐
**مخفی‌سازی:** ⭐⭐⭐⭐⭐
**سرعت:** ⭐⭐⭐⭐☆

---

## نیازمندی اصلی: دامنه

برای این روش به یک دامنه نیاز دارید.

**گزینه ۱: DuckDNS (رایگان و پیشنهادی)**
- کاملاً رایگان
- آسان برای راه‌اندازی
- زیردامنه دریافت می‌کنید (مثلاً myproxy.duckdns.org)

**گزینه ۲: دامنه پولی**
- از هر سایت ثبت دامنه بخرید
- کنترل کامل دارید
- حرفه‌ای‌تر است

---

--------------------------------------------------
مرحله ۱: خرید سرور VPS
--------------------------------------------------

**اگر از قبل سرور لینوکس با Ubuntu دارید، این مرحله را رد کنید و به مرحله ۲ بروید.**

**برای خرید از IONOS (پیشنهادی):** [راهنمای خرید سرور از IONOS](../buy-ionos-server.fa.md)

### نکات خرید:
- سیستم‌عامل: **Ubuntu**
- پلن ارزان کافی است
- لوکیشن به انتخاب شما

**اطلاعات مورد نیاز از سرور:**
- IP سرور (این را یادداشت کنید!)
- نام کاربری: root
- رمز عبور

---

--------------------------------------------------
مرحله ۲: دریافت دامنه رایگان (DuckDNS)
--------------------------------------------------

**برای راهنمای کامل با تصویر:** [راهنمای دریافت دامنه رایگان از DuckDNS](../get-free-domain.fa.md)

### خلاصه مراحل:

### قدم ۱: ثبت‌نام در DuckDNS

وارد شوید: https://duckdns.org

با GitHub یا Google لاگین کنید.

### قدم ۲: ساخت زیردامنه

یک نام انتخاب کنید (مثلاً):
```
myproxy123.duckdns.org
```

IP سرور IONOS خود را در کادر IP وارد کنید.

TOKEN خود را کپی کنید (نگه دارید).

---

--------------------------------------------------
مرحله ۳: اتصال SSH
--------------------------------------------------

**[راهنمای اتصال به سرور با SSH](../ssh-connection.fa.md)**

خلاصه:
```bash
ssh root@SERVER-IP
```

---

--------------------------------------------------
مرحله ۴: نصب لایه ۷ (دامنه واقعی + TLS)
--------------------------------------------------

این دستور را اجرا کنید:

```bash
curl -fsSL https://raw.githubusercontent.com/myotgo/Proxy/main/layer7-real-domain/install.sh -o install.sh && bash install.sh
```

**در طول نصب از شما پرسیده می‌شود:**
1. دامنه شما (مثلاً: myproxy123.duckdns.org)
2. ایمیل شما (برای Let's Encrypt)
<img width="1178" height="602" alt="Screenshot 2026-01-29 094843" src="https://github.com/user-attachments/assets/6a295b18-3915-417e-9837-de77eee0db0c" />


اسکریپت:
- گواهی TLS معتبر می‌گیرد
- VLESS gRPC را روی پورت 443 راه‌اندازی می‌کند
- همه چیز را آماده می‌کند

---

--------------------------------------------------
مرحله ۵: اضافه کردن کاربر
--------------------------------------------------

برای هر نفر یک کاربر بسازید. بعد از اضافه کردن کاربر، **۲ کانفیگ JSON** نمایش داده می‌شود:
- کانفیگ iOS (برای NPV Tunnel)
- کانفیگ Android (برای NetMod)

```bash
curl -fsSL https://raw.githubusercontent.com/myotgo/Proxy/main/layer7-real-domain/add-user.sh -o add-user.sh && bash add-user.sh
```
<img width="1541" height="1327" alt="Screenshot 2026-01-29 095609" src="https://github.com/user-attachments/assets/d4a840bc-25f9-4347-a9b0-6bc1998f060c" />

**توجه:** اگر همان نام کاربری را دوباره اضافه کنید، همان کانفیگ قبلی برگردانده می‌شود.

---

--------------------------------------------------
مرحله ۶: مانیتورینگ کاربران
--------------------------------------------------

برای مشاهده کاربران متصل و وضعیت سرور:

```bash
curl -fsSL https://raw.githubusercontent.com/myotgo/Proxy/main/common/view-users.sh -o view-users.sh && bash view-users.sh
```

---

--------------------------------------------------
مرحله ۷: حذف کاربر (در صورت نیاز)
--------------------------------------------------

```bash
curl -fsSL https://raw.githubusercontent.com/myotgo/Proxy/main/layer7-real-domain/delete-user.sh -o delete-user.sh && bash delete-user.sh username
```

بعد از حذف، کاربر دیگر نمی‌تواند با کانفیگ قبلی متصل شود.

---

## استفاده در iOS

[راهنمای اتصال با iOS (NPV Tunnel)](./iOS-SETUP.md)

---

## استفاده در Android

[راهنمای اتصال با Android (NetMod)](./ANDROID-SETUP.md)

---

## آپدیت خودکار DNS (اختیاری)

اگر IP سرور عوض شود، این دستور را روی سرور اجرا کنید:

```bash
curl "https://www.duckdns.org/update?domains=myproxy123&token=YOUR_TOKEN&ip="
```

برای آپدیت خودکار هر 5 دقیقه:

```bash
crontab -e
```

این خط را اضافه کنید:
```
*/5 * * * * curl -fs "https://www.duckdns.org/update?domains=myproxy123&token=YOUR_TOKEN&ip=" >/dev/null
```

---

## نکات مهم

- این **بهترین روش کلی** است
- از DPI، فیلتر SNI، و Active Probing عبور می‌کند
- گواهی معتبر مرورگر دارد
- سخت‌ترین برای فیلتر شدن
- برای iOS: NPV Tunnel
- برای Android: NetMod
- دامنه و UUID را ایمن نگه دارید

---

## خلاصه نهایی

| سوال | پاسخ |
|------|------|
| کاملاً رایگان؟ | ✅ بله |
| سخت برای فیلتر شدن؟ | ✅ بسیار سخت |
| مناسب سانسور شدید؟ | ✅ بله |
| نیاز به دامنه؟ | ✅ بله (DuckDNS رایگان) |

---
